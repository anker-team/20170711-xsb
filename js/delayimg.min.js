window.delayimg = (function(b, j, f) {
	var k = [],
		a, e, l, h, i;
	var c = function(p) {
		var o = p.getBoundingClientRect();
		return (((o.top >= 0 && o.left >= 0 && o.top) <= (b.innerHeight || j.documentElement.clientHeight) + parseInt(e)) && o.bottom + 40 > 0)
	};
	var d = function() {
		for (var o = k.length; o--;) {
			var p = k[o];
			if (c(p)) {
				if (p.getAttribute("data-delay-background") !== null) {
					p.style.opacity = 1;
					p.style.backgroundImage = "url(" + p.getAttribute("data-delay-background") + ")";
					p.style.display ="block";
//					p.style.width ="100%";
//					p.style.backgroundSize = "cover";
					p.removeAttribute("data-delay-background");
				} else {
					p.src = p.getAttribute("data-delay");
					p.style.opacity = 1;
					p.onload = function() {
						p.removeAttribute("data-delay");
						p.removeAttribute("height");
						p.parentNode.style.backgroundColor = "transparent";
					}
				}
				k.splice(o, 1)
			}
		}
	};
	var n = function() {
		clearTimeout(i);
		i = setTimeout(d, l);
		if (k.length <= 0) {
			h.removeEventListener("scroll", n)
		}
	};
	var m = function(p) {
		k = [];		
		a = j.querySelectorAll("img[data-delay],[data-delay-background]");
		var p = p || {};
		e = p.offset || 0;
		l = p.throttle || 250;
		h = p.content || b;
		//alert(p.content);
		for (var o = 0; o < a.length; o++) {
			k.push(a[o])
		}
		n();
		h.addEventListener("scroll", n, false)
	};
	var g = function() {
		k = [];
		a = j.querySelectorAll("img[data-delay],[data-delay-background]");
		for (var o = 0; o < a.length; o++) {
			k.push(a[o])
		}
		n();
		h.addEventListener("scroll", n, false)
	};
	return {
		init: m,
		render: g
	}
})(window, document);